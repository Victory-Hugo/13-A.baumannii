# EToKiçŽ¯å¢ƒéƒ¨ç½²è¶…è¯¦ç»†å°ç™½æŒ‡å—

## ðŸŽ¯ è¿™ä¸ªæŒ‡å—é€‚åˆè°ï¼Ÿ
- å®Œå…¨ä¸æ‡‚Linuxçš„æ–°æ‰‹ç”¨æˆ·
- éœ€è¦åœ¨æ–°æœåŠ¡å™¨ä¸Šéƒ¨ç½²EToKiçš„ç ”ç©¶äººå‘˜
- æƒ³è¦å¿«é€Ÿå¤åˆ¶å·¥ä½œçŽ¯å¢ƒçš„ç”¨æˆ·

## ðŸ“¦ ä½ ä¼šå¾—åˆ°ä»€ä¹ˆï¼Ÿ
ä¸€ä¸ªåä¸º `etoki_complete_YYYYMMDD_HHMMSS.tar.gz` çš„æ–‡ä»¶ï¼ŒåŒ…å«ï¼š
- å®Œæ•´é…ç½®çš„EToKiçŽ¯å¢ƒ
- æ‰€æœ‰å¿…éœ€çš„è½¯ä»¶ä¾èµ–
- Kraken2æ•°æ®åº“ï¼ˆç”¨äºŽè´¨é‡æŽ§åˆ¶ï¼‰
- è‡ªåŠ¨å®‰è£…è„šæœ¬

## ðŸš€ é›¶åŸºç¡€éƒ¨ç½²æ•™ç¨‹

### ç¬¬1æ­¥ï¼šå‡†å¤‡å·¥ä½œ

#### 1.1 æ£€æŸ¥æœåŠ¡å™¨è¦æ±‚
åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šè¿è¡Œè¿™äº›å‘½ä»¤ï¼Œç¡®ä¿æ»¡è¶³åŸºæœ¬è¦æ±‚ï¼š

```bash
# æ£€æŸ¥æ“ä½œç³»ç»Ÿï¼ˆåº”è¯¥æ˜¯Linuxï¼‰
uname -a

# æ£€æŸ¥å¯ç”¨ç£ç›˜ç©ºé—´ï¼ˆè‡³å°‘éœ€è¦15GBï¼‰
df -h

# æ£€æŸ¥å†…å­˜ï¼ˆå»ºè®®8GBä»¥ä¸Šï¼‰
free -h

# æ£€æŸ¥condaæ˜¯å¦å·²å®‰è£…
conda --version
```

**é‡è¦æé†’ï¼š**
- âœ… å¦‚æžœçœ‹åˆ°condaç‰ˆæœ¬å·ï¼Œè¯´æ˜Žcondaå·²å®‰è£…
- âŒ å¦‚æžœæç¤º"command not found"ï¼Œéœ€è¦å…ˆå®‰è£…conda

#### 1.2 å¦‚æžœéœ€è¦å®‰è£…condaï¼ˆä»…å½“ä¸Šä¸€æ­¥å¤±è´¥æ—¶ï¼‰
```bash
# ä¸‹è½½Minicondaï¼ˆæŽ¨èï¼‰
wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh

# å®‰è£…
bash Miniconda3-latest-Linux-x86_64.sh

# é‡æ–°å¯åŠ¨ç»ˆç«¯æˆ–è¿è¡Œ
source ~/.bashrc

# éªŒè¯å®‰è£…
conda --version
```

### ç¬¬2æ­¥ï¼šä¸Šä¼ å’Œè§£åŽ‹æ–‡ä»¶

#### 2.1 ä¸Šä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨
ä½¿ç”¨ä»¥ä¸‹ä»»ä¸€æ–¹æ³•å°†æ‰“åŒ…æ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼š

**æ–¹æ³•Aï¼šä½¿ç”¨scpï¼ˆä»Žæœ¬åœ°ç”µè„‘ï¼‰**
```bash
scp etoki_complete_*.tar.gz username@server_ip:/home/username/
```

**æ–¹æ³•Bï¼šä½¿ç”¨wgetï¼ˆå¦‚æžœæ–‡ä»¶åœ¨ç½‘ä¸Šï¼‰**
```bash
wget http://your-url/etoki_complete_*.tar.gz
```

**æ–¹æ³•Cï¼šä½¿ç”¨æ–‡ä»¶ä¼ è¾“å·¥å…·**
- WinSCP (Windows)
- FileZilla
- æˆ–æœåŠ¡å™¨æä¾›çš„æ–‡ä»¶ä¸Šä¼ ç•Œé¢

#### 2.2 è§£åŽ‹æ–‡ä»¶
```bash
# è¿›å…¥å­˜æ”¾æ–‡ä»¶çš„ç›®å½•
cd /home/username/

# è§£åŽ‹æ–‡ä»¶ï¼ˆæ›¿æ¢ä¸ºå®žé™…æ–‡ä»¶åï¼‰
tar -xzf etoki_complete_*.tar.gz

# è¿›å…¥è§£åŽ‹åŽçš„ç›®å½•
cd etoki_complete_*/
```

### ç¬¬3æ­¥ï¼šä¸€é”®å®‰è£…ï¼ˆæŽ¨èæ–¹æ³•ï¼‰

#### 3.1 è¿è¡Œè‡ªåŠ¨å®‰è£…è„šæœ¬
```bash
# ç¡®ä¿è„šæœ¬æœ‰æ‰§è¡Œæƒé™
chmod +x install_etoki.sh

# è¿è¡Œå®‰è£…è„šæœ¬
./install_etoki.sh
```

#### 3.2 è§‚å¯Ÿå®‰è£…è¿‡ç¨‹
å®‰è£…è„šæœ¬ä¼šæ˜¾ç¤ºè¯¦ç»†çš„è¿›åº¦ä¿¡æ¯ï¼š
```
=== EToKiçŽ¯å¢ƒå®‰è£…ç¨‹åº ===
å¼€å§‹æ—¶é—´: [æ—¶é—´]
âœ“ æ£€æµ‹åˆ°conda: conda 4.x.x
âœ“ Condaå®‰è£…è·¯å¾„: /home/username/miniconda3
æ­¥éª¤1: åˆ›å»ºcondaçŽ¯å¢ƒ...
æ­¥éª¤2: è§£åŽ‹äºŒè¿›åˆ¶æ–‡ä»¶...
æ­¥éª¤3: å®‰è£…krakenæ•°æ®åº“...
æ­¥éª¤4: éªŒè¯å®‰è£…...
âœ“ EToKié…ç½®éªŒè¯æˆåŠŸ
=== å®‰è£…å®Œæˆ ===
```

### ç¬¬4æ­¥ï¼šéªŒè¯å®‰è£…

#### 4.1 æ¿€æ´»çŽ¯å¢ƒ
```bash
conda activate etoki
```
**æœŸæœ›ç»“æžœï¼š** å‘½ä»¤æç¤ºç¬¦å‰é¢ä¼šå‡ºçŽ° `(etoki)`

#### 4.2 æ£€æŸ¥é…ç½®
```bash
EToKi.py configure
```
**æœŸæœ›ç»“æžœï¼š** çœ‹åˆ°ä¸€é•¿ä¸²è½¯ä»¶æ£€æŸ¥ï¼Œæœ€åŽæ˜¾ç¤º "Configuration complete."

#### 4.3 æµ‹è¯•åŠŸèƒ½
```bash
# æŸ¥çœ‹EToKiå¸®åŠ©
EToKi.py --help

# æŸ¥çœ‹ç»„è£…åŠŸèƒ½å¸®åŠ©
EToKi.py assemble --help
```

### ç¬¬5æ­¥ï¼šå¼€å§‹ä½¿ç”¨

#### 5.1 åŸºæœ¬ä½¿ç”¨æµç¨‹
æ¯æ¬¡ä½¿ç”¨å‰éƒ½éœ€è¦æ¿€æ´»çŽ¯å¢ƒï¼š
```bash
conda activate etoki
```

#### 5.2 è¿è¡ŒåŸºå› ç»„ç»„è£…
```bash
# åŸºæœ¬ç»„è£…ï¼ˆä¸ä½¿ç”¨è´¨æŽ§ï¼‰
EToKi.py assemble --pe1 reads_1.fastq --pe2 reads_2.fastq -o output_folder

# ä½¿ç”¨krakenè´¨æŽ§çš„ç»„è£…ï¼ˆæŽ¨èï¼‰
EToKi.py assemble --pe1 reads_1.fastq --pe2 reads_2.fastq --kraken -o output_folder
```

## ðŸ†˜ å¸¸è§é—®é¢˜è§£å†³

### é—®é¢˜1ï¼šcondaå‘½ä»¤ä¸å­˜åœ¨
**ç—‡çŠ¶ï¼š** è¿è¡Œcondaæ—¶æç¤º "command not found"
**è§£å†³ï¼š** é‡æ–°åˆå§‹åŒ–conda
```bash
source ~/miniconda3/etc/profile.d/conda.sh
conda init bash
source ~/.bashrc
```

### é—®é¢˜2ï¼šæƒé™é”™è¯¯
**ç—‡çŠ¶ï¼š** æç¤º "Permission denied"
**è§£å†³ï¼š** ä¿®å¤æƒé™
```bash
chmod -R 755 ~/miniconda3/envs/etoki/
```

### é—®é¢˜3ï¼šç£ç›˜ç©ºé—´ä¸è¶³
**ç—‡çŠ¶ï¼š** å®‰è£…è¿‡ç¨‹ä¸­æç¤ºç©ºé—´ä¸è¶³
**è§£å†³ï¼š** 
```bash
# æ£€æŸ¥ç©ºé—´ä½¿ç”¨
df -h
# æ¸…ç†ä¸å¿…è¦çš„æ–‡ä»¶æˆ–é€‰æ‹©å…¶ä»–ç›®å½•
```

### é—®é¢˜4ï¼šJavaé”™è¯¯
**ç—‡çŠ¶ï¼š** pilonç›¸å…³é”™è¯¯
**è§£å†³ï¼š** é‡æ–°å®‰è£…Java
```bash
conda activate etoki
conda install openjdk=11 -y
```

### é—®é¢˜5ï¼šç½‘ç»œè¿žæŽ¥é—®é¢˜
**ç—‡çŠ¶ï¼š** condaåˆ›å»ºçŽ¯å¢ƒæ—¶ä¸‹è½½å¤±è´¥
**è§£å†³ï¼š** 
```bash
# ä½¿ç”¨å›½å†…é•œåƒæº
conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/
conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/
conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/conda-forge/
```

## ðŸ’¡ ä½¿ç”¨æŠ€å·§

### æŠ€å·§1ï¼šåˆ›å»ºå¿«æ·å¯åŠ¨è„šæœ¬
```bash
# åˆ›å»ºå¯åŠ¨è„šæœ¬
cat > ~/start_etoki.sh << 'EOF'
#!/bin/bash
source ~/miniconda3/etc/profile.d/conda.sh
conda activate etoki
echo "EToKiçŽ¯å¢ƒå·²æ¿€æ´»ï¼Œå½“å‰ç‰ˆæœ¬ï¼š"
EToKi.py --version
EOF

chmod +x ~/start_etoki.sh

# ä½¿ç”¨æ–¹æ³•
~/start_etoki.sh
```

### æŠ€å·§2ï¼šè®¾ç½®çŽ¯å¢ƒåˆ«å
åœ¨ `~/.bashrc` æ–‡ä»¶æœ«å°¾æ·»åŠ ï¼š
```bash
alias etoki='conda activate etoki'
alias etoki-check='conda activate etoki && EToKi.py configure'
```

### æŠ€å·§3ï¼šæ‰¹é‡å¤„ç†è„šæœ¬æ¨¡æ¿
```bash
#!/bin/bash
# æ‰¹é‡å¤„ç†å¤šä¸ªæ ·æœ¬

# æ¿€æ´»çŽ¯å¢ƒ
conda activate etoki

# è®¾ç½®è¾“å…¥å’Œè¾“å‡ºç›®å½•
INPUT_DIR="/path/to/fastq/files"
OUTPUT_DIR="/path/to/results"

# æ‰¹é‡å¤„ç†
for file1 in ${INPUT_DIR}/*_1.fastq; do
    file2=${file1/_1.fastq/_2.fastq}
    sample=$(basename $file1 _1.fastq)
    
    echo "å¤„ç†æ ·æœ¬: $sample"
    EToKi.py assemble --pe1 $file1 --pe2 $file2 --kraken -o ${OUTPUT_DIR}/${sample}
done
```

## ðŸ“‹ å®Œæ•´çš„å‘½ä»¤æ¸…å•

### çŽ¯å¢ƒç®¡ç†
```bash
# æ¿€æ´»çŽ¯å¢ƒ
conda activate etoki

# é€€å‡ºçŽ¯å¢ƒ
conda deactivate

# æŸ¥çœ‹æ‰€æœ‰çŽ¯å¢ƒ
conda env list

# åˆ é™¤çŽ¯å¢ƒï¼ˆå¦‚æžœéœ€è¦é‡è£…ï¼‰
conda env remove -n etoki
```

### EToKiå‘½ä»¤
```bash
# æŸ¥çœ‹ç‰ˆæœ¬
EToKi.py --version

# æ£€æŸ¥é…ç½®
EToKi.py configure

# åŸºæœ¬ç»„è£…
EToKi.py assemble --pe1 R1.fastq --pe2 R2.fastq -o output

# é«˜çº§ç»„è£…ï¼ˆä½¿ç”¨æ‰€æœ‰åŠŸèƒ½ï¼‰
EToKi.py assemble --pe1 R1.fastq --pe2 R2.fastq --kraken --minLen 500 --maxMem 32 -o output

# MLSTåˆ†æž
EToKi.py MLSType -i genome.fasta -o mlst_output

# ç³»ç»Ÿè¿›åŒ–åˆ†æž
EToKi.py phylo -t tree_input -o phylo_output
```

## ðŸŽ“ å­¦ä¹ èµ„æº

### å®˜æ–¹æ–‡æ¡£
- EToKi GitHub: https://github.com/zheminzhou/EToKi
- Condaç”¨æˆ·æŒ‡å—: https://docs.conda.io/projects/conda/en/latest/user-guide/

### æŽ¨èé˜…è¯»
- åŸºå› ç»„ç»„è£…åŸºç¡€çŸ¥è¯†
- MLSTç³»ç»Ÿå‘è‚²åˆ†æž
- å¾®ç”Ÿç‰©åŸºå› ç»„å­¦å…¥é—¨

## ðŸ æ€»ç»“

æ­å–œï¼å¦‚æžœæ‚¨æŒ‰ç…§æœ¬æŒ‡å—æ“ä½œåˆ°è¿™é‡Œï¼Œæ‚¨å·²ç»æˆåŠŸï¼š
1. âœ… åœ¨æ–°æœåŠ¡å™¨ä¸Šéƒ¨ç½²äº†å®Œæ•´çš„EToKiçŽ¯å¢ƒ
2. âœ… éªŒè¯äº†æ‰€æœ‰ç»„ä»¶æ­£å¸¸å·¥ä½œ
3. âœ… æŽŒæ¡äº†åŸºæœ¬çš„ä½¿ç”¨æ–¹æ³•

çŽ°åœ¨æ‚¨å¯ä»¥å¼€å§‹è¿›è¡ŒåŸºå› ç»„ç»„è£…å’Œåˆ†æžå·¥ä½œäº†ï¼

**è®°ä½æœ€é‡è¦çš„ä¸‰ä¸ªå‘½ä»¤ï¼š**
1. `conda activate etoki` - æ¿€æ´»çŽ¯å¢ƒ
2. `EToKi.py configure` - æ£€æŸ¥é…ç½®
3. `EToKi.py assemble --help` - æŸ¥çœ‹å¸®åŠ©

ç¥æ‚¨ç§‘ç ”å·¥ä½œé¡ºåˆ©ï¼ðŸ§¬ðŸ”¬
